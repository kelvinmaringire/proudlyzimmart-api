import{X as c,Y as u,N as p}from"./index-Btp_LviN.js";const f=c("blog",{state:()=>({posts:[],postDetails:{},pagination:{count:0,next:null,previous:null,page:1,pageSize:12},filters:{search:null,ordering:"-published_date"},isLoading:!1,isLoadingDetails:!1,isLoadingMore:!1,error:null}),getters:{getPostById:e=>s=>e.postDetails[s]||null,hasMorePosts:e=>!!e.pagination.next,totalPosts:e=>e.pagination.count||e.posts.length,isEmpty:e=>e.posts.length===0&&!e.isLoading},actions:{async fetchPosts(e={}){const{append:s=!1,filters:a={},page:r=1}=e;s?this.isLoadingMore=!0:(this.isLoading=!0,this.error=null);try{const t={page:r,page_size:this.pagination.pageSize,is_published:!0,...this.filters,...a};Object.keys(t).forEach(n=>{(t[n]===null||t[n]===void 0||t[n]==="")&&delete t[n]});const l="/api/blog/";console.log("Fetching blog posts from:",l,{params:t}),console.log("Full URL:",`${u.defaults.baseURL}${l}`);const o=await u.get(l,{params:t});console.log("Blog posts API response:",{status:o.status,data:o.data,hasResults:!!o.data?.results});const i=o.data;i.results?(s?this.posts=[...this.posts,...i.results]:this.posts=i.results,this.pagination={count:i.count||0,next:i.next||null,previous:i.previous||null,page:r,pageSize:this.pagination.pageSize}):Array.isArray(i)?(s?this.posts=[...this.posts,...i]:this.posts=i,this.pagination={count:i.length,next:null,previous:null,page:r,pageSize:this.pagination.pageSize}):s?this.posts=[...this.posts,i]:this.posts=[i];const g=s?i.results||i:this.posts;return Array.isArray(g)&&g.forEach(n=>{n.id&&(this.postDetails[n.id]=n)}),o.data}catch(t){const l=t.response?.data?.detail||t.response?.data?.message||t.message||"Failed to fetch blog posts";if(this.error=l,console.error("Fetch blog posts API error:",{status:t.response?.status,statusText:t.response?.statusText,url:t.config?.url,fullURL:t.config?`${t.config.baseURL}${t.config.url}`:"unknown",data:t.response?.data,message:t.message,fullError:t}),!s&&t.response?.status!==401){let o="Failed to load blog posts.";t.response?.status===404?o=`Blog endpoint not found (404). Expected: ${t.config?.baseURL||""}${t.config?.url||"/api/blog/"}. Please verify your backend API endpoint.`:t.response?.status===500?o="Server error. Please try again later.":t.message?.includes("Network Error")||t.code==="ERR_NETWORK"?o="Network error. Please check your connection.":o=l,p.create({type:"negative",message:o,position:"top",timeout:5e3})}throw t}finally{this.isLoading=!1,this.isLoadingMore=!1}},async loadMorePosts(){if(!this.hasMorePosts||this.isLoadingMore)return;const e=this.pagination.page+1;await this.fetchPosts({append:!0,page:e})},async fetchPostDetails(e,s=!1){if(!s&&this.postDetails[e])return this.postDetails[e];this.isLoadingDetails=!0,this.error=null;try{const r=(await u.get(`/api/blog/${e}/`)).data;r.id&&(this.postDetails[r.id]=r);try{await u.post(`/api/blog/${e}/increment-view/`)}catch{console.log("View count increment not available")}return r}catch(a){this.error=a.response?.data||a.message||"Failed to fetch blog post details",console.error("Fetch blog post details API error:",{status:a.response?.status,statusText:a.response?.statusText,data:a.response?.data,fullError:a});const r=a.response?.data?.detail||a.response?.data?.message||"Failed to load blog post. Please try again.";throw p.create({type:"negative",message:r,position:"top",timeout:3e3}),a}finally{this.isLoadingDetails=!1}},async searchPosts(e){this.filters.search=e||null,this.pagination.page=1,await this.fetchPosts({append:!1,page:1})},async sortPosts(e){this.filters.ordering=e||"-published_date",this.pagination.page=1,await this.fetchPosts({append:!1,page:1})},clearFilters(){this.filters={search:null,ordering:"-published_date"},this.pagination.page=1},reset(){this.posts=[],this.postDetails={},this.pagination={count:0,next:null,previous:null,page:1,pageSize:12},this.filters={search:null,ordering:"-published_date"},this.error=null},async initBlog(){try{this.posts.length===0&&await this.fetchPosts({append:!1,page:1})}catch(e){e.response?.status===401?console.warn("Blog API requires authentication. Blog posts should be publicly accessible. Posts list will be empty."):console.error("Error initializing blog:",e)}}}});function d(e){let s=null;if(e?.featured_image_url?s=e.featured_image_url:e?.featured_image&&(typeof e.featured_image=="string"?s=e.featured_image:e.featured_image.url?s=e.featured_image.url:e.featured_image.file&&(s=e.featured_image.file)),s){if(s.startsWith("http://")||s.startsWith("https://"))return s;const a=u.defaults.baseURL||"http://127.0.0.1:8002/",r=a.endsWith("/")?a.slice(0,-1):a,t=s.startsWith("/")?s:`/${s}`;return`${r}${t}`}return"https://via.placeholder.com/800x450?text=ProudlyZimmart+Story"}function m(e){if(e?.author_name)return e.author_name;const s=e?.author;return typeof s=="string"?s:s?.username?s.username:(s?.first_name||s?.last_name)&&`${s.first_name||""} ${s.last_name||""}`.trim()||"Anonymous"}function y(e){return e?new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):""}function b(e,s){return e?e.length<=s?e:e.substring(0,s).trim()+"...":""}function P(e){console.error("Image failed to load:",e.target.src),e.target.src&&!e.target.src.includes("placeholder")&&(e.target.src="https://via.placeholder.com/800x450?text=ProudlyZimmart+Story",e.target.onerror=null)}export{P as a,d as b,b as c,m as d,y as e,f as u};
