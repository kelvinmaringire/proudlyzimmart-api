import{X as f,Y as o,N as c}from"./index-Btp_LviN.js";const p=f("manufacturers",{state:()=>({manufacturers:[],manufacturerDetails:{},manufacturerProducts:{},pagination:{count:0,next:null,previous:null,page:1,pageSize:20},filters:{search:null,province:null,city:null,isFeatured:null,isVerified:null,ordering:null},isLoading:!1,isLoadingDetails:!1,isLoadingMore:!1,isLoadingProducts:!1,error:null}),getters:{getManufacturerById:e=>a=>e.manufacturerDetails[a]||null,hasMoreManufacturers:e=>!!e.pagination.next,totalManufacturers:e=>e.pagination.count||e.manufacturers.length,isEmpty:e=>e.manufacturers.length===0&&!e.isLoading,getManufacturerProducts:e=>a=>e.manufacturerProducts[a]||[]},actions:{async fetchManufacturers(e={}){const{append:a=!1,filters:t={},page:i=1}=e;a?this.isLoadingMore=!0:(this.isLoading=!0,this.error=null);try{const s={page:i,page_size:this.pagination.pageSize,...this.filters,...t};Object.keys(s).forEach(n=>{(s[n]===null||s[n]===void 0||s[n]==="")&&delete s[n]});const u=await o.get("/api/manufacturers/",{params:s}),r=u.data;console.log("Manufacturers Store - API Response:",{data:r,hasResults:!!r.results,resultsCount:r.results?.length||0,count:r.count}),r.results?(a?this.manufacturers=[...this.manufacturers,...r.results]:this.manufacturers=r.results,this.pagination={count:r.count||0,next:r.next||null,previous:r.previous||null,page:i,pageSize:this.pagination.pageSize}):Array.isArray(r)?(a?this.manufacturers=[...this.manufacturers,...r]:this.manufacturers=r,this.pagination={count:r.length,next:null,previous:null,page:i,pageSize:this.pagination.pageSize}):a?this.manufacturers=[...this.manufacturers,r]:this.manufacturers=[r];const l=a?r.results||r:this.manufacturers;return Array.isArray(l)&&l.forEach(n=>{n.id&&(this.manufacturerDetails[n.id]=n)}),u.data}catch(s){if(this.error=s.response?.data||s.message||"Failed to fetch manufacturers",console.error("Fetch manufacturers API error:",{status:s.response?.status,statusText:s.response?.statusText,data:s.response?.data,fullError:s}),!a&&s.response?.status!==401){const u=s.response?.data?.detail||s.response?.data?.message||"Failed to load manufacturers. Please try again.";c.create({type:"negative",message:u,position:"top",timeout:3e3})}else s.response?.status===401&&console.warn("Manufacturers endpoint returned 401 Unauthorized. Manufacturers should be publicly accessible. Please check backend permissions.");throw s}finally{this.isLoading=!1,this.isLoadingMore=!1}},async loadMoreManufacturers(){if(!this.hasMoreManufacturers||this.isLoadingMore)return;const e=this.pagination.page+1;await this.fetchManufacturers({append:!0,page:e})},async fetchManufacturerDetails(e,a=!1){if(!a&&this.manufacturerDetails[e])return this.manufacturerDetails[e];this.isLoadingDetails=!0,this.error=null;try{const i=(await o.get(`/api/manufacturers/${e}/`)).data;return i.id&&(this.manufacturerDetails[i.id]=i),i}catch(t){this.error=t.response?.data||t.message||"Failed to fetch manufacturer details",console.error("Fetch manufacturer details API error:",{status:t.response?.status,statusText:t.response?.statusText,data:t.response?.data,fullError:t});const i=t.response?.data?.detail||t.response?.data?.message||"Failed to load manufacturer details. Please try again.";throw c.create({type:"negative",message:i,position:"top",timeout:3e3}),t}finally{this.isLoadingDetails=!1}},async fetchFeaturedManufacturers(e=10){this.isLoading=!0,this.error=null;try{const t=(await o.get("/api/manufacturers/featured/",{params:{limit:e}})).data,i=Array.isArray(t)?t:t.results||[];return i.forEach(s=>{s.id&&(this.manufacturerDetails[s.id]=s)}),i}catch(a){throw this.error=a.response?.data||a.message||"Failed to fetch featured manufacturers",console.error("Fetch featured manufacturers API error:",{status:a.response?.status,statusText:a.response?.statusText,data:a.response?.data,fullError:a}),a}finally{this.isLoading=!1}},async fetchManufacturerProducts(e,a=!1){if(!a&&this.manufacturerProducts[e])return this.manufacturerProducts[e];this.isLoadingProducts=!0,this.error=null;try{const t=await o.get(`/api/manufacturers/${e}/products/`),i=t.data.results||t.data||[];return this.manufacturerProducts[e]=i,i}catch(t){throw this.error=t.response?.data||t.message||"Failed to fetch manufacturer products",console.error("Fetch manufacturer products API error:",{status:t.response?.status,statusText:t.response?.statusText,data:t.response?.data,fullError:t}),t}finally{this.isLoadingProducts=!1}},async searchManufacturers(e){this.filters.search=e||null,this.pagination.page=1,await this.fetchManufacturers({append:!1,page:1})},async filterByLocation(e,a=null){this.filters.province=e||null,this.filters.city=a||null,this.pagination.page=1,await this.fetchManufacturers({append:!1,page:1})},async filterByFeatured(e){this.filters.isFeatured=e!==null?e:null,this.pagination.page=1,await this.fetchManufacturers({append:!1,page:1})},async filterByVerified(e){this.filters.isVerified=e!==null?e:null,this.pagination.page=1,await this.fetchManufacturers({append:!1,page:1})},async sortManufacturers(e){this.filters.ordering=e||null,this.pagination.page=1,await this.fetchManufacturers({append:!1,page:1})},clearFilters(){this.filters={search:null,province:null,city:null,isFeatured:null,isVerified:null,ordering:null},this.pagination.page=1},reset(){this.manufacturers=[],this.manufacturerDetails={},this.manufacturerProducts={},this.pagination={count:0,next:null,previous:null,page:1,pageSize:20},this.filters={search:null,province:null,city:null,isFeatured:null,isVerified:null,ordering:null},this.error=null}}});export{p as u};
